{"version":3,"sources":["RelatedObjectLookups.js"],"names":[],"mappings":"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","file":"RelatedObjectLookups-compiled.js","sourcesContent":["/*global SelectBox, interpolate*/\n// Handles related-objects functionality: lookup link for raw_id_fields\n// and Add Another links.\n\n(function($) {\n    'use strict';\n\n    // IE doesn't accept periods or dashes in the window name, but the element IDs\n    // we use to generate popup window names may contain them, therefore we map them\n    // to allowed characters in a reversible way so that we can locate the correct\n    // element when the popup window is dismissed.\n    function id_to_windowname(text) {\n        text = text.replace(/\\./g, '__dot__');\n        text = text.replace(/\\-/g, '__dash__');\n        return text;\n    }\n\n    function windowname_to_id(text) {\n        text = text.replace(/__dot__/g, '.');\n        text = text.replace(/__dash__/g, '-');\n        return text;\n    }\n\n    function showAdminPopup(triggeringLink, name_regexp, add_popup) {\n        var name = triggeringLink.id.replace(name_regexp, '');\n        name = id_to_windowname(name);\n        var href = triggeringLink.href;\n        if (add_popup) {\n            if (href.indexOf('?') === -1) {\n                href += '?_popup=1';\n            } else {\n                href += '&_popup=1';\n            }\n        }\n        var win = window.open(href, name, 'height=500,width=800,resizable=yes,scrollbars=yes');\n        win.focus();\n        return false;\n    }\n\n    function showRelatedObjectLookupPopup(triggeringLink) {\n        return showAdminPopup(triggeringLink, /^lookup_/, true);\n    }\n\n    function dismissRelatedLookupPopup(win, chosenId) {\n        var name = windowname_to_id(win.name);\n        var elem = document.getElementById(name);\n        if (elem.className.indexOf('vManyToManyRawIdAdminField') !== -1 && elem.value) {\n            elem.value += ',' + chosenId;\n        } else {\n            document.getElementById(name).value = chosenId;\n        }\n        win.close();\n    }\n\n    function showRelatedObjectPopup(triggeringLink) {\n        return showAdminPopup(triggeringLink, /^(change|add|delete)_/, false);\n    }\n\n    function updateRelatedObjectLinks(triggeringLink) {\n        var $this = $(triggeringLink);\n        var siblings = $this.nextAll('.change-related, .delete-related');\n        if (!siblings.length) {\n            return;\n        }\n        var value = $this.val();\n        if (value) {\n            siblings.each(function() {\n                var elm = $(this);\n                elm.attr('href', elm.attr('data-href-template').replace('__fk__', value));\n            });\n        } else {\n            siblings.removeAttr('href');\n        }\n    }\n\n    function dismissAddRelatedObjectPopup(win, newId, newRepr) {\n        var name = windowname_to_id(win.name);\n        var elem = document.getElementById(name);\n        if (elem) {\n            var elemName = elem.nodeName.toUpperCase();\n            if (elemName === 'SELECT') {\n                elem.options[elem.options.length] = new Option(newRepr, newId, true, true);\n            } else if (elemName === 'INPUT') {\n                if (elem.className.indexOf('vManyToManyRawIdAdminField') !== -1 && elem.value) {\n                    elem.value += ',' + newId;\n                } else {\n                    elem.value = newId;\n                }\n            }\n            // Trigger a change event to update related links if required.\n            $(elem).trigger('change');\n        } else {\n            var toId = name + \"_to\";\n            var o = new Option(newRepr, newId);\n            SelectBox.add_to_cache(toId, o);\n            SelectBox.redisplay(toId);\n        }\n        win.close();\n    }\n\n    function dismissChangeRelatedObjectPopup(win, objId, newRepr, newId) {\n        var id = windowname_to_id(win.name).replace(/^edit_/, '');\n        var selectsSelector = interpolate('#%s, #%s_from, #%s_to', [id, id, id]);\n        var selects = $(selectsSelector);\n        selects.find('option').each(function() {\n            if (this.value === objId) {\n                this.textContent = newRepr;\n                this.value = newId;\n            }\n        });\n        selects.next().find('.select2-selection__rendered').each(function() {\n            // The element can have a clear button as a child.\n            // Use the lastChild to modify only the displayed value.\n            this.lastChild.textContent = newRepr;\n            this.title = newRepr;\n        });\n        win.close();\n    }\n\n    function dismissDeleteRelatedObjectPopup(win, objId) {\n        var id = windowname_to_id(win.name).replace(/^delete_/, '');\n        var selectsSelector = interpolate('#%s, #%s_from, #%s_to', [id, id, id]);\n        var selects = $(selectsSelector);\n        selects.find('option').each(function() {\n            if (this.value === objId) {\n                $(this).remove();\n            }\n        }).trigger('change');\n        win.close();\n    }\n\n    // Global for testing purposes\n    window.id_to_windowname = id_to_windowname;\n    window.windowname_to_id = windowname_to_id;\n\n    window.showRelatedObjectLookupPopup = showRelatedObjectLookupPopup;\n    window.dismissRelatedLookupPopup = dismissRelatedLookupPopup;\n    window.showRelatedObjectPopup = showRelatedObjectPopup;\n    window.updateRelatedObjectLinks = updateRelatedObjectLinks;\n    window.dismissAddRelatedObjectPopup = dismissAddRelatedObjectPopup;\n    window.dismissChangeRelatedObjectPopup = dismissChangeRelatedObjectPopup;\n    window.dismissDeleteRelatedObjectPopup = dismissDeleteRelatedObjectPopup;\n\n    // Kept for backward compatibility\n    window.showAddAnotherPopup = showRelatedObjectPopup;\n    window.dismissAddAnotherPopup = dismissAddRelatedObjectPopup;\n\n    $(document).ready(function() {\n        $(\"a[data-popup-opener]\").click(function(event) {\n            event.preventDefault();\n            opener.dismissRelatedLookupPopup(window, $(this).data(\"popup-opener\"));\n        });\n        $('body').on('click', '.related-widget-wrapper-link', function(e) {\n            e.preventDefault();\n            if (this.href) {\n                var event = $.Event('django:show-related', {href: this.href});\n                $(this).trigger(event);\n                if (!event.isDefaultPrevented()) {\n                    showRelatedObjectPopup(this);\n                }\n            }\n        });\n        $('body').on('change', '.related-widget-wrapper select', function(e) {\n            var event = $.Event('django:update-related');\n            $(this).trigger(event);\n            if (!event.isDefaultPrevented()) {\n                updateRelatedObjectLinks(this);\n            }\n        });\n        $('.related-widget-wrapper select').trigger('change');\n        $('body').on('click', '.related-lookup', function(e) {\n            e.preventDefault();\n            var event = $.Event('django:lookup-related');\n            $(this).trigger(event);\n            if (!event.isDefaultPrevented()) {\n                showRelatedObjectLookupPopup(this);\n            }\n        });\n    });\n\n})(django.jQuery);\n"]}